{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Resources": {
    "LambdaFunction": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "FunctionName": "MyLambdaFunction",
        "Handler": "lambda_to_dynamodb.lambda_handler",
        "Role": "arn:aws:iam::your-account-id:role/Lambda2DynamoDB",
        "Code": {
          "S3Bucket": "codecommit-repo-name",
          "S3Key": "test/lambda_to_dynamodb.py"
        },
        "Runtime": "python3.8",
        "Layers": ["arn:aws:s3:::opensky-s3-bucket-temp-files/requests_layer.zip"],
        "Timeout": 60
      }
    },
    "EventRule": {
      "Type": "AWS::Events::Rule",
      "Properties": {
        "Description": "Trigger Lambda every 5 minutes",
        "ScheduleExpression": "rate(5 minutes)",
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": { "Fn::GetAtt": ["LambdaFunction", "Arn"] },
            "Id": "TargetFunctionV1"
          }
        ]
      }
    },
    "PermissionForEventsToInvokeLambda": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "FunctionName": { "Ref": "LambdaFunction" },
        "Action": "lambda:InvokeFunction",
        "Principal": "events.amazonaws.com",
        "SourceArn": { "Fn::GetAtt": ["EventRule", "Arn"] }
      }
    }
  }
}

