{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "CloudFormation Template for launching EC2 instance in us-east-1 region with S3 upload capability",
  "Parameters": {
    "KeyName": {
      "Description": "Name of an existing EC2 KeyPair to enable SSH access",
      "Type": "AWS::EC2::KeyPair::KeyName"
    },
    "InstanceType": {
      "Description": "EC2 instance type",
      "Type": "String",
      "Default": "t2.micro",
      "AllowedValues": [
        "t2.micro",
        "t2.small",
        "t2.medium",
        "m3.medium",
        "m3.large"
      ],
      "ConstraintDescription": "Must be a valid EC2 instance type from the allowed list"
    }
  },
  "Resources": {
    "MyEC2Instance": {
      "Type": "AWS::EC2::Instance",
      "Properties": {
        "InstanceType": {
          "Ref": "InstanceType"
        },
        "KeyName": {
          "Ref": "KeyName"
        },
        "ImageId": "ami-08a52ddb321b32a8c",
        "IamInstanceProfile": "EC2toS3Role",
        "UserData": {
          "Fn::Base64": {
            "Fn::Sub": "#!/bin/bash\nyum update -y\nyum install aws-cli python3-pip -y\nmkdir python\npip3 install requests -t ./python\nzip -r requests_layer.zip ./python\naws s3 cp requests_layer.zip s3://opensky-s3-bucket-temp-files/"
          }
        }
      }
    }
  }
}

